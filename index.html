<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://public-frontend-cos.metadl.com/mgx/img/favicon.png" type="image/png">
    <title>Cart√£o CARE - Formul√°rio de Observa√ß√£o</title>
    // <link rel="stylesheet" href="./Care card form.css">
    <style>
	
	* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    padding: 20px;
    line-height: 1.4;
    color: #333;
}

.container {
    max-width: 1000px;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

/* QR Code Section - Enhanced */
.qr-section {
    background: linear-gradient(135deg, #0066cc, #004499);
    color: white;
    padding: 25px;
    text-align: center;
}

.qr-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.qr-header h3 {
    color: white;
    font-size: 20px;
    font-weight: bold;
}

.qr-container {
    text-align: center;
    padding: 25px;
    background: white;
    border-radius: 12px;
    margin-top: 15px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.qr-display {
    margin-bottom: 20px;
}

.qr-placeholder {
    width: 200px;
    height: 200px;
    margin: 0 auto;
    border: 2px solid #0066cc;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    position: relative;
}

.qr-pattern {
    width: 180px;
    height: 180px;
    position: relative;
    background: repeating-linear-gradient(
        0deg,
        #0066cc 0px,
        #0066cc 2px,
        white 2px,
        white 4px
    ),
    repeating-linear-gradient(
        90deg,
        #0066cc 0px,
        #0066cc 2px,
        white 2px,
        white 4px
    );
}

.qr-corner {
    position: absolute;
    width: 30px;
    height: 30px;
    border: 4px solid #0066cc;
    background: white;
}

.qr-corner.top-left {
    top: 10px;
    left: 10px;
}

.qr-corner.top-right {
    top: 10px;
    right: 10px;
}

.qr-corner.bottom-left {
    bottom: 10px;
    left: 10px;
}

.qr-dots {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 3px;
}

.qr-dots span {
    width: 6px;
    height: 6px;
    background: #0066cc;
    border-radius: 1px;
}

.qr-container p {
    color: #666;
    font-size: 14px;
    margin-bottom: 15px;
    font-weight: 500;
}

.qr-url {
    background: #f8f9ff;
    padding: 10px;
    border-radius: 6px;
    margin: 15px 0;
    font-size: 12px;
    color: #666;
    word-break: break-all;
}

.care-card {
    border: 3px solid #0066cc;
    border-radius: 10px;
    padding: 20px;
    position: relative;
}

/* Header Styles */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 2px solid #0066cc;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    background: #f8f9ff;
}

.card-number {
    flex: 1;
}

.card-number label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
    font-size: 14px;
}

.card-number input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
}

.logo-section {
    display: flex;
    align-items: center;
    gap: 15px;
}

.people-icons {
    display: flex;
    gap: 5px;
}

.icon {
    width: 30px;
    height: 40px;
    border-radius: 15px 15px 5px 5px;
    position: relative;
}

.icon::before {
    content: '';
    position: absolute;
    top: 5px;
    left: 50%;
    transform: translateX(-50%);
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: inherit;
}

.icon.orange {
    background: #ff6600;
}

.icon.green {
    background: #00cc66;
}

.icon.blue {
    background: #0066cc;
}

.care-logo h1 {
    font-size: 24px;
    font-weight: bold;
    color: #cc0000;
    text-align: center;
    line-height: 1.1;
}

/* Section Styles */
.section {
    margin-bottom: 25px;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 20px;
}

.section:last-of-type {
    border-bottom: none;
}

.section h2 {
    background: #0066cc;
    color: white;
    padding: 8px 12px;
    margin-bottom: 15px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 4px;
}

/* Form Styles */
.form-row {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    align-items: end;
}

.form-group {
    flex: 1;
}

.form-group.half {
    flex: 2;
}

.form-group.quarter {
    flex: 1;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 14px;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
}

.form-group input:required,
.form-group textarea:required {
    border-left: 3px solid #0066cc;
}

textarea {
    resize: vertical;
    min-height: 100px;
}

/* Checkbox and Radio Styles */
.checkbox-row,
.checkbox-grid {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.checkbox-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
}

.checkbox-label,
.radio-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
    position: relative;
    padding-left: 25px;
}

.checkbox-label input[type="checkbox"],
.radio-label input[type="radio"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    width: 0;
    height: 0;
}

.checkmark,
.radiomark {
    position: absolute;
    left: 0;
    top: 2px;
    height: 16px;
    width: 16px;
    background-color: white;
    border: 2px solid #0066cc;
}

.checkmark {
    border-radius: 3px;
}

.radiomark {
    border-radius: 50%;
}

.checkbox-label:hover input ~ .checkmark,
.radio-label:hover input ~ .radiomark {
    background-color: #f0f8ff;
}

.checkbox-label input:checked ~ .checkmark,
.radio-label input:checked ~ .radiomark {
    background-color: #0066cc;
}

.checkmark:after,
.radiomark:after {
    content: "";
    position: absolute;
    display: none;
}

.checkbox-label input:checked ~ .checkmark:after {
    display: block;
    left: 4px;
    top: 1px;
    width: 4px;
    height: 8px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

.radio-label input:checked ~ .radiomark:after {
    display: block;
    top: 3px;
    left: 3px;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: white;
}

/* Question Groups */
.question-group {
    margin-bottom: 20px;
}

.question-group p {
    font-weight: bold;
    margin-bottom: 10px;
    font-size: 14px;
}

.radio-group {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    align-items: center;
}

.sub-text {
    font-size: 12px;
    font-style: italic;
    color: #666;
    font-weight: normal;
}

.inline-input {
    width: 150px !important;
    margin-left: 10px;
    display: inline-block;
}

.date-input {
    width: 200px;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
}

/* Footer Styles */
.footer-message {
    background: #f0f8ff;
    padding: 10px;
    border-radius: 4px;
    margin: 20px 0;
    text-align: center;
    font-style: italic;
    font-size: 14px;
}

.cultural-message {
    text-align: center;
    margin: 20px 0;
    padding: 15px;
    background: #f8f8f8;
    border-radius: 4px;
}

.cultural-message h3 {
    font-size: 18px;
    margin-bottom: 5px;
}

.cultural-message .red {
    color: #cc0000;
    font-weight: bold;
}

.cultural-message p {
    font-size: 14px;
    color: #666;
}

/* Submit Section - VERY PROMINENT */
.submit-section {
    margin: 40px 0;
    padding: 0;
}

.submit-highlight {
    background: linear-gradient(135deg, #00cc66, #00aa55);
    color: white;
    padding: 30px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 8px 16px rgba(0, 204, 102, 0.3);
    border: 3px solid #00aa55;
    animation: glow 2s infinite alternate;
}

.submit-highlight h3 {
    font-size: 24px;
    margin-bottom: 10px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}

.submit-highlight > p {
    font-size: 16px;
    margin-bottom: 20px;
    opacity: 0.9;
}

.btn-submit-large {
    background: linear-gradient(135deg, #ffffff, #f0f0f0);
    color: #00aa55;
    font-size: 20px;
    font-weight: bold;
    padding: 20px 40px;
    border: 3px solid #ffffff;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    min-width: 300px;
}

.btn-submit-large:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    background: linear-gradient(135deg, #f8f8f8, #e8e8e8);
}

.email-info {
    margin-top: 15px;
    font-size: 14px;
    opacity: 0.9;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin: 30px 0 20px;
    flex-wrap: wrap;
    padding: 20px;
    background: #f8f9ff;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.3s ease;
    min-width: 120px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.btn-primary {
    background: #0066cc;
    color: white;
}

.btn-primary:hover {
    background: #0052a3;
}

.btn-success {
    background: #00cc66;
    color: white;
}

.btn-success:hover {
    background: #00aa55;
}

.btn-secondary {
    background: #666;
    color: white;
}

.btn-secondary:hover {
    background: #555;
}

.btn-danger {
    background: #cc0000;
    color: white;
}

.btn-danger:hover {
    background: #aa0000;
}

/* MODEC Logo */
.modec-logo {
    position: absolute;
    bottom: 20px;
    right: 20px;
}

.logo-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #cc0000;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.logo-text {
    color: white;
    font-weight: bold;
    font-size: 12px;
}

/* Modal Styles */
.modal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background-color: white;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    animation: modalSlideIn 0.3s ease-out;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #e0e0e0;
    background: #f8f9ff;
    border-radius: 12px 12px 0 0;
}

.modal-header h3 {
    color: #0066cc;
    margin: 0;
    font-size: 18px;
}

.close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s ease;
}

.close:hover {
    color: #000;
}

.modal-body {
    padding: 20px;
    text-align: center;
}

.modal-body p {
    margin-bottom: 10px;
    font-size: 16px;
}

.modal-body strong {
    color: #0066cc;
    font-size: 18px;
}

.modal-footer {
    display: flex;
    justify-content: center;
    gap: 15px;
    padding: 20px;
    border-top: 1px solid #e0e0e0;
    background: #f8f8f8;
    border-radius: 0 0 12px 12px;
}

/* Form Validation Styles */
.form-group input.error,
.form-group textarea.error {
    border-color: #cc0000;
    background-color: #fff5f5;
}

.form-group input.success,
.form-group textarea.success {
    border-color: #00cc66;
    background-color: #f5fff5;
}

/* Required field indicator */
label:after {
    content: "";
}

label[for="observerName"]:after,
label[for="company"]:after,
label[for="location"]:after {
    content: " *";
    color: #cc0000;
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        margin: 10px;
        padding: 0;
    }
    
    .care-card {
        padding: 15px;
    }
    
    .header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .form-row {
        flex-direction: column;
        gap: 10px;
    }
    
    .checkbox-row,
    .radio-group {
        flex-direction: column;
        gap: 10px;
    }
    
    .checkbox-grid {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 200px;
    }
    
    .btn-submit-large {
        min-width: 250px;
        font-size: 18px;
        padding: 18px 30px;
    }
    
    .submit-highlight h3 {
        font-size: 20px;
    }
    
    .modec-logo {
        position: static;
        text-align: center;
        margin-top: 20px;
    }
    
    .qr-header {
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }
}

/* Print Styles */
@media print {
    body {
        background: white;
        padding: 0;
    }
    
    .container {
        box-shadow: none;
        border-radius: 0;
    }
    
    .qr-section,
    .submit-section,
    .action-buttons,
    .modal {
        display: none;
    }
    
    .care-card {
        border-color: black;
    }
    
    .section h2 {
        background: white;
        color: black;
        border: 1px solid black;
    }
    
    .header {
        border-color: black;
        background: white;
    }
    
    .checkmark,
    .radiomark {
        border-color: black;
    }
    
    .checkbox-label input:checked ~ .checkmark,
    .radio-label input:checked ~ .radiomark {
        background-color: black;
    }
    
    .logo-circle {
        background: white;
        border-color: black;
    }
    
    .logo-text {
        color: black;
    }
}

/* Animations */
@keyframes glow {
    0% { box-shadow: 0 8px 16px rgba(0, 204, 102, 0.3); }
    100% { box-shadow: 0 8px 20px rgba(0, 204, 102, 0.5), 0 0 20px rgba(0, 204, 102, 0.2); }
}

@keyframes modalSlideIn {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.btn-submit-large.submitting {
    animation: pulse 1s infinite;
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: #0066cc;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #0052a3;
}

/* Firefox scrollbar */
* {
    scrollbar-width: thin;
    scrollbar-color: #0066cc #f1f1f1;
}

    </style>
    <script>

	// Care Card Form Application with Email Submission and QR Code
document.addEventListener('DOMContentLoaded', function() {
    console.log('Care Card Form with Email & QR Code loaded successfully!');
    
    // Initialize form functionality
    initializeForm();
    loadSavedData();
    setupEventListeners();
    setupQRCode();
});

function initializeForm() {
    // Set current date and time
    const now = new Date();
    const dateInput = document.getElementById('date');
    const timeInput = document.getElementById('time');
    
    if (dateInput) {
        dateInput.value = now.toISOString().split('T')[0];
    }
    
    if (timeInput) {
        timeInput.value = now.toTimeString().slice(0, 5);
    }
    
    // Generate random card number if empty
    const cardNumberInput = document.getElementById('cardNumber');
    if (cardNumberInput && !cardNumberInput.value) {
        cardNumberInput.value = generateCardNumber();
    }
}

function generateCardNumber() {
    const prefix = 'CARE';
    const randomNum = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
    return `${prefix}-${randomNum}`;
}

function setupEventListeners() {
    // Save button
    const saveBtn = document.getElementById('saveBtn');
    if (saveBtn) {
        saveBtn.addEventListener('click', saveFormData);
    }
    
    // Submit button
    const submitBtn = document.getElementById('submitBtn');
    if (submitBtn) {
        submitBtn.addEventListener('click', handleFormSubmission);
    }
    
    // Print button
    const printBtn = document.getElementById('printBtn');
    if (printBtn) {
        printBtn.addEventListener('click', printForm);
    }
    
    // Clear button
    const clearBtn = document.getElementById('clearBtn');
    if (clearBtn) {
        clearBtn.addEventListener('click', clearForm);
    }
    
    // QR Code toggle
    const toggleQR = document.getElementById('toggleQR');
    if (toggleQR) {
        toggleQR.addEventListener('click', toggleQRCode);
    }
    
    // Copy URL button
    const copyUrl = document.getElementById('copyUrl');
    if (copyUrl) {
        copyUrl.addEventListener('click', copyCurrentUrl);
    }
    
    // Modal events
    setupModalEvents();
    
    // Form submission
    const form = document.getElementById('careForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            handleFormSubmission();
        });
        
        // Auto-save on form changes
        form.addEventListener('change', autoSave);
        form.addEventListener('input', debounce(autoSave, 1000));
    }
    
    // Checkbox group management for observation type
    setupCheckboxGroups();
    
    // NOI number input toggle
    setupNoiToggle();
    
    // Form validation
    setupFormValidation();
}

function setupQRCode() {
    // Display current URL
    const currentUrl = window.location.href;
    const urlElement = document.getElementById('currentUrl');
    if (urlElement) {
        urlElement.textContent = currentUrl;
    }
    
    // Show success message for QR code display
    setTimeout(() => {
        showNotification('QR Code gerado com sucesso! Use para acesso m√≥vel.', 'success');
    }, 1000);
}

function toggleQRCode() {
    const qrContainer = document.getElementById('qrContainer');
    const toggleBtn = document.getElementById('toggleQR');
    
    if (qrContainer && toggleBtn) {
        if (qrContainer.style.display === 'none') {
            qrContainer.style.display = 'block';
            toggleBtn.textContent = 'Ocultar QR Code';
        } else {
            qrContainer.style.display = 'none';
            toggleBtn.textContent = 'Mostrar QR Code';
        }
    }
}

function copyCurrentUrl() {
    const currentUrl = window.location.href;
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(currentUrl).then(() => {
            showNotification('URL copiada para a √°rea de transfer√™ncia!', 'success');
        }).catch(() => {
            fallbackCopyTextToClipboard(currentUrl);
        });
    } else {
        fallbackCopyTextToClipboard(currentUrl);
    }
}

function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showNotification('URL copiada para a √°rea de transfer√™ncia!', 'success');
        } else {
            showNotification('Erro ao copiar URL.', 'error');
        }
    } catch (err) {
        showNotification('Erro ao copiar URL.', 'error');
    }
    
    document.body.removeChild(textArea);
}

function setupModalEvents() {
    const modal = document.getElementById('emailModal');
    const closeModal = document.getElementById('closeModal');
    const confirmSend = document.getElementById('confirmSend');
    const cancelSend = document.getElementById('cancelSend');
    
    if (closeModal) {
        closeModal.addEventListener('click', hideEmailModal);
    }
    
    if (cancelSend) {
        cancelSend.addEventListener('click', hideEmailModal);
    }
    
    if (confirmSend) {
        confirmSend.addEventListener('click', confirmEmailSubmission);
    }
    
    // Close modal when clicking outside
    if (modal) {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                hideEmailModal();
            }
        });
    }
}

function handleFormSubmission() {
    // Validate form first
    if (!validateForm()) {
        showNotification('Por favor, preencha todos os campos obrigat√≥rios.', 'error');
        // Scroll to first error
        const firstError = document.querySelector('.error');
        if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
    }
    
    // Show confirmation modal
    showEmailModal();
}

function validateForm() {
    const requiredFields = [
        'observerName',
        'company', 
        'location',
        'description'
    ];
    
    let isValid = true;
    
    requiredFields.forEach(fieldName => {
        const field = document.querySelector(`[name="${fieldName}"]`);
        if (field && !validateField(field)) {
            isValid = false;
        }
    });
    
    // Check if at least one observation type is selected
    const observationTypes = document.querySelectorAll('input[name="observationType"]:checked');
    if (observationTypes.length === 0) {
        showNotification('Por favor, selecione pelo menos um tipo de observa√ß√£o.', 'error');
        isValid = false;
    }
    
    // Check if at least one objective is selected
    const objectives = document.querySelectorAll('input[name="objective"]:checked');
    if (objectives.length === 0) {
        showNotification('Por favor, selecione pelo menos um objetivo da observa√ß√£o.', 'error');
        isValid = false;
    }
    
    return isValid;
}

function showEmailModal() {
    const modal = document.getElementById('emailModal');
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

function hideEmailModal() {
    const modal = document.getElementById('emailModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

function confirmEmailSubmission() {
    hideEmailModal();
    
    // Show loading state
    const submitBtn = document.getElementById('submitBtn');
    if (submitBtn) {
        submitBtn.classList.add('submitting');
        submitBtn.innerHTML = 'üìß ENVIANDO...';
        submitBtn.disabled = true;
    }
    
    // Prepare email data
    const formData = collectFormData();
    const emailBody = formatEmailBody(formData);
    const subject = `Cart√£o CARE - ${formData.cardNumber} - ${formData.observerName}`;
    
    // Create mailto link
    const mailtoLink = `mailto:hseqcoordinator.cdg@modec.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
    
    // Save form data before sending
    saveFormData();
    
    // Open email client
    try {
        window.location.href = mailtoLink;
        
        // Reset button after a delay
        setTimeout(() => {
            if (submitBtn) {
                submitBtn.classList.remove('submitting');
                submitBtn.innerHTML = 'üìß ENVIAR PARA HSEQ';
                submitBtn.disabled = false;
            }
            showNotification('Formul√°rio preparado para envio. Verifique seu cliente de email.', 'success');
        }, 2000);
        
    } catch (error) {
        console.error('Error opening email client:', error);
        
        // Reset button
        if (submitBtn) {
            submitBtn.classList.remove('submitting');
            submitBtn.innerHTML = 'üìß ENVIAR PARA HSEQ';
            submitBtn.disabled = false;
        }
        
        // Show fallback options
        showEmailFallback(formData, emailBody);
    }
}

function formatEmailBody(formData) {
    let body = `CART√ÉO CARE - FORMUL√ÅRIO DE OBSERVA√á√ÉO\n`;
    body += `=========================================\n\n`;
    
    body += `N√öMERO DO CART√ÉO: ${formData.cardNumber}\n`;
    body += `DATA/HORA DE ENVIO: ${new Date().toLocaleString('pt-BR')}\n\n`;
    
    body += `PARTE A - GERAL\n`;
    body += `---------------\n`;
    body += `Nome do observador: ${formData.observerName || 'N/A'}\n`;
    body += `Empresa: ${formData.company || 'N/A'}\n`;
    body += `Local: ${formData.location || 'N/A'}\n`;
    body += `Hora: ${formData.time || 'N/A'}\n`;
    body += `Data: ${formData.date || 'N/A'}\n\n`;
    
    body += `PARTE B - TIPO DE OBSERVA√á√ÉO\n`;
    body += `-----------------------------\n`;
    const observationTypes = Array.isArray(formData.observationType) ? formData.observationType : [formData.observationType];
    body += `Tipos selecionados: ${observationTypes.filter(Boolean).join(', ') || 'Nenhum'}\n\n`;
    
    body += `PARTE C - OBJETIVO DA OBSERVA√á√ÉO\n`;
    body += `--------------------------------\n`;
    const objectives = Array.isArray(formData.objective) ? formData.objective : [formData.objective];
    body += `Objetivos selecionados: ${objectives.filter(Boolean).join(', ') || 'Nenhum'}\n\n`;
    
    body += `PARTE D - DESCRI√á√ÉO DA OBSERVA√á√ÉO\n`;
    body += `----------------------------------\n`;
    body += `${formData.description || 'N/A'}\n\n`;
    
    body += `PARTE E - A√á√ïES E SUGEST√ïES\n`;
    body += `---------------------------\n`;
    body += `Foi poss√≠vel corrigir o problema? ${formData.problemCorrected || 'N/A'}\n`;
    body += `A√ß√£o corretiva/sugest√£o:\n${formData.correctiveAction || 'N/A'}\n\n`;
    
    body += `PARTE F - A√á√ïES DOS SUPERVISORES\n`;
    body += `--------------------------------\n`;
    body += `N√≠vel de gravidade: ${formData.riskLevel || 'N/A'}\n`;
    
    const testQuestions = Array.isArray(formData.testQuestions) ? formData.testQuestions : [formData.testQuestions];
    body += `Perguntas de teste marcadas: ${testQuestions.filter(Boolean).join(', ') || 'Nenhuma'}\n`;
    
    body += `NOI necess√°ria? ${formData.noi || 'N/A'}\n`;
    if (formData.noiNumber) {
        body += `N√∫mero da NOI: ${formData.noiNumber}\n`;
    }
    body += `Data de encerramento: ${formData.closingDate || 'N/A'}\n\n`;
    
    body += `---\n`;
    body += `Formul√°rio enviado atrav√©s do sistema Cart√£o CARE\n`;
    body += `MODEC - A Consci√™ncia Cultural Reside em Todos\n`;
    
    return body;
}

function showEmailFallback(formData, emailBody) {
    const fallbackModal = document.createElement('div');
    fallbackModal.className = 'modal';
    fallbackModal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìß Op√ß√µes de Envio</h3>
                <span class="close" onclick="this.closest('.modal').remove(); document.body.style.overflow='auto';">&times;</span>
            </div>
            <div class="modal-body">
                <p>Escolha uma das op√ß√µes abaixo para enviar o formul√°rio:</p>
                <div style="text-align: center; margin: 20px 0;">
                    <button type="button" class="btn btn-primary" onclick="copyEmailContent()">üìã Copiar Conte√∫do</button>
                    <button type="button" class="btn btn-secondary" onclick="downloadFormData()">üíæ Baixar Dados</button>
                </div>
                <p><strong>Email de destino:</strong> hseqcoordinator.cdg@modec.com</p>
                <textarea readonly style="width: 100%; height: 200px; margin-top: 10px; font-family: monospace; font-size: 12px; border: 1px solid #ccc; border-radius: 4px; padding: 10px;">${emailBody}</textarea>
            </div>
        </div>
    `;
    
    document.body.appendChild(fallbackModal);
    document.body.style.overflow = 'hidden';
    
    // Store data for fallback functions
    window.currentEmailBody = emailBody;
    window.currentFormData = formData;
}

function copyEmailContent() {
    if (window.currentEmailBody) {
        navigator.clipboard.writeText(window.currentEmailBody).then(() => {
            showNotification('Conte√∫do copiado para a √°rea de transfer√™ncia!', 'success');
        }).catch(() => {
            showNotification('Erro ao copiar conte√∫do.', 'error');
        });
    }
}

function downloadFormData() {
    if (window.currentFormData) {
        const dataStr = JSON.stringify(window.currentFormData, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `care-card-${window.currentFormData.cardNumber || 'export'}.json`;
        link.click();
        
        showNotification('Dados baixados com sucesso!', 'success');
    }
}

function setupCheckboxGroups() {
    const observationTypeCheckboxes = document.querySelectorAll('input[name="observationType"]');
    observationTypeCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            validateObservationType();
        });
    });
}

function validateObservationType() {
    const positiva = document.querySelector('input[name="observationType"][value="positiva"]');
    const descumprimento = document.querySelector('input[name="observationType"][value="descumprimento"]');
    
    if (positiva && descumprimento && positiva.checked && descumprimento.checked) {
        showNotification('Aten√ß√£o: Observa√ß√£o positiva e descumprimento selecionados simultaneamente.', 'warning');
    }
}

function setupNoiToggle() {
    const noiRadios = document.querySelectorAll('input[name="noi"]');
    const noiNumberInput = document.querySelector('input[name="noiNumber"]');
    
    noiRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            if (noiNumberInput) {
                noiNumberInput.disabled = this.value !== 'sim';
                if (this.value !== 'sim') {
                    noiNumberInput.value = '';
                }
                noiNumberInput.style.opacity = this.value === 'sim' ? '1' : '0.5';
            }
        });
    });
}

function setupFormValidation() {
    const requiredFields = [
        'observerName',
        'company',
        'location',
        'description'
    ];
    
    requiredFields.forEach(fieldName => {
        const field = document.querySelector(`[name="${fieldName}"]`);
        if (field) {
            field.addEventListener('blur', function() {
                validateField(this);
            });
            field.addEventListener('input', function() {
                if (this.classList.contains('error')) {
                    validateField(this);
                }
            });
        }
    });
}

function validateField(field) {
    const value = field.value.trim();
    const isValid = value.length > 0;
    
    field.classList.toggle('error', !isValid);
    field.classList.toggle('success', isValid);
    
    return isValid;
}

function saveFormData() {
    const formData = collectFormData();
    
    try {
        localStorage.setItem('careCardData', JSON.stringify(formData));
        showNotification('Dados salvos com sucesso!', 'success');
    } catch (error) {
        console.error('Erro ao salvar dados:', error);
        showNotification('Erro ao salvar dados. Tente novamente.', 'error');
    }
}

function loadSavedData() {
    try {
        const savedData = localStorage.getItem('careCardData');
        if (savedData) {
            const formData = JSON.parse(savedData);
            populateForm(formData);
            showNotification('Dados anteriores carregados.', 'info');
        }
    } catch (error) {
        console.error('Erro ao carregar dados salvos:', error);
    }
}

function collectFormData() {
    const form = document.getElementById('careForm');
    const formData = new FormData(form);
    const data = {};
    
    for (let [key, value] of formData.entries()) {
        if (data[key]) {
            if (Array.isArray(data[key])) {
                data[key].push(value);
            } else {
                data[key] = [data[key], value];
            }
        } else {
            data[key] = value;
        }
    }
    
    data.timestamp = new Date().toISOString();
    data.cardNumber = document.getElementById('cardNumber').value;
    
    return data;
}

function populateForm(data) {
    Object.keys(data).forEach(key => {
        const elements = document.querySelectorAll(`[name="${key}"]`);
        
        elements.forEach(element => {
            if (element.type === 'checkbox' || element.type === 'radio') {
                if (Array.isArray(data[key])) {
                    element.checked = data[key].includes(element.value);
                } else {
                    element.checked = element.value === data[key];
                }
            } else {
                element.value = data[key] || '';
            }
        });
    });
    
    if (data.cardNumber) {
        const cardNumberInput = document.getElementById('cardNumber');
        if (cardNumberInput) {
            cardNumberInput.value = data.cardNumber;
        }
    }
}

function clearForm() {
    if (confirm('Tem certeza que deseja limpar todos os dados do formul√°rio?')) {
        const form = document.getElementById('careForm');
        form.reset();
        
        const cardNumberInput = document.getElementById('cardNumber');
        if (cardNumberInput) {
            cardNumberInput.value = generateCardNumber();
        }
        
        initializeForm();
        
        localStorage.removeItem('careCardData');
        localStorage.removeItem('careCardAutoSave');
        
        document.querySelectorAll('.error, .success').forEach(field => {
            field.classList.remove('error', 'success');
        });
        
        showNotification('Formul√°rio limpo com sucesso!', 'success');
    }
}

function printForm() {
    if (!validateForm()) {
        showNotification('Por favor, preencha todos os campos obrigat√≥rios antes de imprimir.', 'error');
        return;
    }
    
    saveFormData();
    window.print();
}

function autoSave() {
    const formData = collectFormData();
    try {
        localStorage.setItem('careCardAutoSave', JSON.stringify(formData));
    } catch (error) {
        console.error('Erro no auto-save:', error);
    }
}

function showNotification(message, type = 'info') {
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 6px;
        color: white;
        font-weight: bold;
        z-index: 1001;
        max-width: 300px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        animation: slideIn 0.3s ease-out;
    `;
    
    switch (type) {
        case 'success':
            notification.style.backgroundColor = '#00cc66';
            break;
        case 'error':
            notification.style.backgroundColor = '#cc0000';
            break;
        case 'warning':
            notification.style.backgroundColor = '#ff6600';
            break;
        default:
            notification.style.backgroundColor = '#0066cc';
    }
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.style.animation = 'slideIn 0.3s ease-out reverse';
            setTimeout(() => {
                notification.remove();
            }, 300);
        }
    }, 4000);
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        saveFormData();
    }
    
    if (e.ctrlKey && e.key === 'p') {
        e.preventDefault();
        printForm();
    }
    
    if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        handleFormSubmission();
    }
    
    if (e.key === 'Escape') {
        hideEmailModal();
        const fallbackModal = document.querySelector('.modal:not(#emailModal)');
        if (fallbackModal) {
            fallbackModal.remove();
            document.body.style.overflow = 'auto';
        }
    }
});

// Make functions available globally
window.copyEmailContent = copyEmailContent;
window.downloadFormData = downloadFormData;

// Show welcome message
setTimeout(() => {
    showNotification('Formul√°rio Cart√£o CARE carregado. Preencha os dados e clique em "ENVIAR PARA HSEQ".', 'info');
}, 500);

    </script>
</head>

<body>
    <div class="container">
        <!-- QR Code Section -->
        <div class="qr-section" id="qrSection">
            <div class="qr-header">
                <h3> Acesso via QR Code</h3>
                <button type="button" id="toggleQR" class="btn btn-secondary">Ocultar QR Code</button>
            </div>
            <div class="qr-container" id="qrContainer">
                <div id="qrcode" class="qr-display">
                    <div class="qr-placeholder">
                        <div class="qr-pattern">
                            <div class="qr-corner top-left"></div>
                            <div class="qr-corner top-right"></div>
                            <div class="qr-corner bottom-left"></div>
                            <div class="qr-dots">
                                <img src="https://qrto.org/pGTeB4">
                            </div>
                        </div>
                    </div>
                </div>
                <p>Escaneie este QR Code para acessar o formul√°rio em dispositivos m√≥veis</p>
                <div class="qr-url">
                    <strong>URL:</strong> <span id="currentUrl">Carregando...</span>
                </div>
                <button type="button" id="copyUrl" class="btn btn-primary">üìã Copiar URL</button>
            </div>
        </div>

        <div class="care-card">
            <!-- Header Section -->
            <div class="header">
                <div class="card-number">
                    <label for="cardNumber">N√∫mero do Cart√£o CARE</label>
                    <input type="text" id="cardNumber" name="cardNumber" placeholder="Digite o n√∫mero">
                </div>
                <div class="logo-section">
                    <div class="people-icons">
                        <span class="icon orange"></span>
                        <span class="icon green"></span>
                        <span class="icon blue"></span>
                    </div>
                    <div class="care-logo">
                        <h1>CART√ÉO<br>CARE</h1>
                    </div>
                </div>
            </div>

            <form id="careForm">
                <!-- PARTE A - Geral -->
                <div class="section">
                    <h2>PARTE A - Geral</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="observerName">Nome do observador *</label>
                            <input type="text" id="observerName" name="observerName" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="company">Empresa *</label>
                            <input type="text" id="company" name="company" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="location">Local *</label>
                            <input type="text" id="location" name="location" required>
                        </div>
                        <div class="form-group quarter">
                            <label for="time">Hora</label>
                            <input type="time" id="time" name="time">
                        </div>
                        <div class="form-group quarter">
                            <label for="date">Data</label>
                            <input type="date" id="date" name="date">
                        </div>
                    </div>
                </div>

                <!-- PARTE B - Tipo de observa√ß√£o -->
                <div class="section">
                    <h2>PARTE B - Tipo de observa√ß√£o</h2>
                    <div class="checkbox-row">
                        <label class="checkbox-label">
                            <input type="checkbox" name="observationType" value="positiva">
                            <span class="checkmark"></span>
                            Positiva
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="observationType" value="descumprimento">
                            <span class="checkmark"></span>
                            Descumprimento da norma/Risco
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="observationType" value="melhoria">
                            <span class="checkmark"></span>
                            Melhoria
                        </label>
                    </div>
                </div>

                <!-- PARTE C - Objetivo da observa√ß√£o -->
                <div class="section">
                    <h2>PARTE C - Objetivo da observa√ß√£o</h2>
                    <div class="checkbox-grid">
                        <label class="checkbox-label">
                            <input type="checkbox" name="objective" value="pessoas/atos">
                            <span class="checkmark"></span>
                            Pessoas/atos
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="objective" value="patrimonio">
                            <span class="checkmark"></span>
                            Patrim√¥nio/equipamentos
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="objective" value="condicao">
                            <span class="checkmark"></span>
                            Condi√ß√£o
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="objective" value="qualidade">
                            <span class="checkmark"></span>
                            Qualidade - Procedimento / sistema
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="objective" value="ambiental">
                            <span class="checkmark"></span>
                            Ambiental
                        </label>
                    </div>
                </div>

                <!-- PARTE D - Descri√ß√£o da observa√ß√£o -->
                <div class="section">
                    <h2>PARTE D - Descri√ß√£o da observa√ß√£o</h2>
                    <textarea id="description" name="description" rows="8" placeholder="Descreva detalhadamente a observa√ß√£o..." required></textarea>
                </div>

                <!-- PARTE E - A√ß√µes e sugest√µes -->
                <div class="section">
                    <h2>PARTE E - A√ß√µes e sugest√µes</h2>
                    <div class="question-group">
                        <p>‚Ä¢ Foi poss√≠vel corrigir o problema?</p>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="problemCorrected" value="sim">
                                <span class="radiomark"></span>
                                Sim
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="problemCorrected" value="nao">
                                <span class="radiomark"></span>
                                N√£o
                            </label>
                        </div>
                    </div>
                    <div class="question-group">
                        <p>‚Ä¢ Descreva a a√ß√£o corretiva tomada ou sua sugest√£o para impedir a repeti√ß√£o:</p>
                        <textarea name="correctiveAction" rows="6" placeholder="Descreva a a√ß√£o corretiva ou sugest√£o..."></textarea>
                    </div>
                </div>

                <!-- PARTE F - A√ß√µes e sugest√µes dos supervisores -->
                <div class="section">
                    <h2>PARTE F - A√ß√µes e sugest√µes dos supervisores:</h2>
                    
                    <div class="question-group">
                        <p>‚Ä¢ N√≠vel de Gravidade Potencial do Risco</p>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="riskLevel" value="alta">
                                <span class="radiomark"></span>
                                Alta
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="riskLevel" value="media">
                                <span class="radiomark"></span>
                                M√©dia
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="riskLevel" value="baixa">
                                <span class="radiomark"></span>
                                Baixa
                            </label>
                        </div>
                    </div>

                    <div class="question-group">
                        <p>‚Ä¢ Perguntas de teste - Se a resposta for "Sim" para qualquer uma das perguntas abaixo, envie uma NOI:</p>
                        
                        <label class="checkbox-label">
                            <input type="checkbox" name="testQuestions" value="perda">
                            <span class="checkmark"></span>
                            Houve alguma perda?
                        </label>
                        
                        <label class="checkbox-label">
                            <input type="checkbox" name="testQuestions" value="condicao_anterior">
                            <span class="checkmark"></span>
                            Esta condi√ß√£o / comportamento aconteceu antes?<br>
                            <span class="sub-text">(Para n√≠vel de risco m√©dio ou alto)</span>
                        </label>
                        
                        <label class="checkbox-label">
                            <input type="checkbox" name="testQuestions" value="equipamentos_criticos">
                            <span class="checkmark"></span>
                            Equipamentos Cr√≠ticos de Seguran√ßa / Produ√ß√£o foram afetados?
                        </label>
                    </div>

                    <div class="question-group">
                        <p>‚Ä¢ NOI?</p>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="noi" value="sim">
                                <span class="radiomark"></span>
                                Se sim, NOI n¬∫: <input type="text" class="inline-input" name="noiNumber">
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="noi" value="nao">
                                <span class="radiomark"></span>
                                N√£o
                            </label>
                        </div>
                    </div>

                    <div class="question-group">
                        <p>‚Ä¢ Data de encerramento do Cart√£o CARE:</p>
                        <input type="date" name="closingDate" class="date-input">
                    </div>
                </div>

                <!-- Footer Message -->
                <div class="footer-message">
                    <p>Por favor, preencha as Partes de (A) a (E) deste cart√£o e entregue a seu supervisor</p>
                </div>

                <!-- Cultural Message -->
                <div class="cultural-message">
                    <h3>A <span class="red">C</span>onsci√™ncia <span class="red">C</span>ultural <span class="red">R</span>eside em <span class="red">T</span>odos</h3>
                    <p>Obrigado por manter o seu local de trabalho seguro!</p>
                </div>

                <!-- Action Buttons - Made VERY prominent -->
                <div class="submit-section">
                    <div class="submit-highlight">
                        <h3>‚úÖ FINALIZAR E ENVIAR FORMUL√ÅRIO</h3>
                        <p>Clique no bot√£o abaixo para enviar o formul√°rio para o coordenador HSEQ</p>
                        <button type="submit" id="submitBtn" class="btn btn-submit-large">
                            üìß ENVIAR PARA HSEQ
                        </button>
                        <p class="email-info">üìß Destino: <strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="432b302632202c2c31272a2d22372c316d202724032e2c2726206d202c2e">[email&#160;protected]</a></strong></p>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="button" id="saveBtn" class="btn btn-primary">üíæ Salvar</button>
                    <button type="button" id="printBtn" class="btn btn-secondary">üñ®Ô∏è Imprimir</button>
                    <button type="button" id="clearBtn" class="btn btn-danger">üóëÔ∏è Limpar</button>
                </div>
            </form>

            <!-- MODEC Logo -->
            <div class="modec-logo">
                <div class="logo-circle">
                    <span class="logo-text">MODEC</span>
                </div>
            </div>
        </div>

        <!-- Email Confirmation Modal -->
        <div id="emailModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üìß Confirmar Envio</h3>
                    <span class="close" id="closeModal">&times;</span>
                </div>
                <div class="modal-body">
                    <p>O formul√°rio ser√° enviado para:</p>
                    <p><strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="88e0fbedf9ebe7e7faece1e6e9fce7faa6ebecefc8e5e7ecedeba6ebe7e5">[email&#160;protected]</a></strong></p>
                    <p>Deseja continuar?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="confirmSend" class="btn btn-success">‚úÖ Sim, Enviar</button>
                    <button type="button" id="cancelSend" class="btn btn-secondary">‚ùå Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="module" src="./script.js"></script>
</body>

</html>








